
\begin{zsection}
  \SECTION\ basic\_processes4 \parents\ circus\_toolkit
\end{zsection}

\begin{circus}
    \circchannel\ out: \nat
\end{circus}

\begin{circus}
    \circprocess\ FibStateMultipleEnv ~~\circdef~~ \circbegin
\end{circus}

\begin{circusaction}
    \circstate\ FibState ~~==~~ [~ x, y: \nat ~] \\
    InitFibState ~~==~~ [~ FibState~' | x' = y' = 1 ~]
\end{circusaction}

\begin{circusaction}
    InitFib ~~\circdef~~ out~!1 \then out~!1 \then InitFibState
\end{circusaction}

\begin{schema}{OutFibOp}
    \Delta FibState; next!: \nat
\where
    next! = y' = x + y \land x' = y
\end{schema}

\begin{circusaction}
    OutFib ~~\circdef~~ \circmu\ X @ (~ \circvar\ next: \nat @ OutFibState \circseq out~!next \then X ~)
\end{circusaction}

\begin{circusaction}
    @ InitFib ~\circseq~ OutFib
\end{circusaction}

\begin{circus}
    \circend
\end{circus}


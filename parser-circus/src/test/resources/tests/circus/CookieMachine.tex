\documentclass{article}

\usepackage{vmargin}
\usepackage{circus}

\setpapersize{A4}
%\setmarginsrb{leftmargin}{topmargin}{rightmargin}{bottommargin}{headheight}{headsep}{footheight}{footskip}
%\setmarginsrb{20mm}{10mm}{20mm}{10mm}{12pt}{11mm}{0pt}{11mm}
%\setmarginsrb{25mm}{20mm}{25mm}{20mm}{12pt}{11mm}{0pt}{10mm}
\setmarginsrb{40mm}{20mm}{40mm}{20mm}{12pt}{11mm}{0pt}{10mm}

\begin{document}

\title{\Circus\ Cookie Machine}
\author{Leonardo Freitas}
\date{February 2007}

\maketitle

\begin{abstract}
    \noindent Examples from Manuela Xavier MSc thesis.
\end{abstract}

\begin{zsection}
  \SECTION\ circus\_channels \parents\ circus\_toolkit
\end{zsection}

\begin{zed}
   COOKIE ::= ok | notok
\end{zed}

\begin{circus}
   \circchannel\ in, change: \nat \\
   \circchannel\ out: COOKIE
\end{circus}

\begin{circus}
    \circprocess\ CookieMachine \circdef \circbegin
    \also %
    \begin{axdef}
       cookieValue, cookieQuantity: \nat
    \end{axdef}
    \circstate\ State ~~==~~ [~ money, quantity: \nat ~] \\
    InitState ~~==~~ [~ State~' | money' = 0 \land quantity' = cookieQuantity ~] \\
    InputMoney ~~==~~ [~ \Delta State; x?: \net | money \leq cookieValue \land money' = money + x? ~] \\
    Input ~~\circdef~~ money \leq cookieValue \circquard in~?x \circthen InputMoney \\
    \begin{schema}{OutputCookieOk}
        \Delta State \\
        o!: COOKIE
    \where
        money \geq cookieValue \\
        quantity > 0 \\
        money' = money - cookieValue \\
        quantity' = quantity - 1 \\
        o! = ok
    \end{schema}
    \begin{schema}{OutputCookieNotOk}
        \Delta State \\
        o!: COOKIE
    \where
        money \geq cookieValue \\
        quantity = 0 \\
        money' = money \\
        o! = notok
    \end{schema}
    Output ~~\circdef~~ money \geq cookieValue \circvar \\
        \t1 (\circvar o: COOKIE @ OutputCookie \circseq out~!o \circthen change~!money \circthen Skip) \\
    \t1 @ StateInit \circseq (\circmu\ X @ (Input \extchoice Output) \circseq X) \\
   \circend
\end{circus}

\end{document}

<project name="czt-cup" default ="install" basedir=".">
  <property name="czt.home" location="../../"/>
  <property file="${czt.home}/czt.properties"/>
  <property name="czt.lib" location="${czt.home}/${jar.dir}"/>
  <property name="jar.file" location="${czt.lib}/${java_cup.jar.file}"/>
  <property name="runtime.jar.file"
            location="${czt.lib}/${java_cup.runtime.jar.file}"/>
  <property name="src.dir" location="src"/>
  <property name="build.dir" location="build"/>
  <property name="build.src.dir"
            location="${build.dir}/src/net/sourceforge/czt"/>
  <property name="build.class.dir" location="${build.dir}/classes"/>

  <path id="classpath">
    <pathelement path="${java.class.path}"/>
  </path>

  <target name="init">
    <tstamp />
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.class.dir}"/>
    <mkdir dir="${build.src.dir}"/>
  </target>

  <target name="copy" depends="init">
    <copy todir="${build.src.dir}" overwrite="true">
      <fileset dir="${src.dir}"></fileset></copy>
  </target>

  <target name="replace" depends="copy">
    <replace dir="${build.src.dir}" 
      token="java_cup."
      value="net.sourceforge.czt.java_cup.">
    </replace>
    <replace dir="${build.src.dir}" 
      token="java_cup/"
      value="net/sourceforge/czt/java_cup/">
    </replace>
    <replace dir="${build.src.dir}" 
      token="java_cup;"
      value="net.sourceforge.czt.java_cup;">
    </replace>
  </target>

  <target name="compile" depends="replace"
    description="Compiles the sources.">
    <javac source="1.5" srcdir="${build.src.dir}"
           destdir="${build.class.dir}"
           debug="${debug}" debuglevel="${debuglevel}" optimize="${optimize}">
      <classpath refid="classpath"/>
    </javac>
  </target>

  <target name="install" depends="compile"
    description="Builds and installs the jar file in '../lib'.">
    <mkdir dir="${czt.lib}"/>
    <jar jarfile="${jar.file}">
      <fileset dir="${build.class.dir}"/>
      <manifest>
        <attribute name="Main-Class" value="java_cup/Main" />
	<attribute name="Class-Path" value="${java_cup.jar.file}" />
      </manifest>
    </jar>
    <jar jarfile="${runtime.jar.file}"
	 basedir="${build.class.dir}" 
         includes="net/sourceforge/czt/java_cup/runtime/*">
     </jar>
  </target>

  <target name="clean" description="Cleans up.">
    <delete dir="${build.dir}"/>
  </target>
</project>

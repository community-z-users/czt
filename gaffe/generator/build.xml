<?xml version="1.0" encoding="UTF-8"?>

<!--
GAfFE - A (G)raphical (A)nimator (F)ront(E)nd for Z - Part of the CZT Project.
Copyright 2003 Nicholas Daley

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-->

<project name="GAfFE Generator" default="all" basedir=".">
  <description>GAfFE - A (G)raphical (A)nimator (F)ront(E)nd for Z.</description>
  <property name="gaffe.generator.source.path" location="src"/>
  <!-- property name="gaffe.generator.resources.path" location="resources"/ -->
  <property name="gaffe.generator.build.path" location="classes"/>
  <property name="gaffe.generator.api.path" location="doc/api"/>

  <target name="-getcztbasejar" unless="czt.base.jar.path">
    <input message="What is the path of the CZT Java core base jar file?" addproperty="czt.base.jar.path"/>
  </target>
  <target name="-getcztcorejar" unless="czt.core.jar.path">
    <input message="What is the path of the CZT Java core jar file?" addproperty="czt.core.jar.path"/>
  </target>
  <target name="-getcztjaxbjar" unless="czt.jaxb.jar.path">
    <input message="What is the path of the CZT Java core jaxb jar file?" addproperty="czt.jaxb.jar.path"/>
  </target>

  <target name="doc" depends="-init" description="Build the API documentation.">   
    <mkdir dir="${gaffe.generator.api.path}"/>
    <javadoc packagenames="net.sourceforge.czt.*"
	     sourcepath="${gaffe.generator.source.path}"
             destdir="${gaffe.generator.api.path}"
	     classpathref="gaffe.generator.class.path"  
             access="private" use="yes" version="yes" author="yes"/>
  </target>

  <target name="classpath" depends="-init" description="Show the classpath">
    <pathconvert targetos="unix" property="tmp.clspath"
	    refid="gaffe.generator.class.path">
    </pathconvert>
    <echo message="CLASSPATH = ${tmp.clspath}"/>
  </target>

  <target name="-init">
    <!-- Check if an appropriate version of Java is being used -->
    <condition property="java.is.too.old">
      <or>
        <equals arg1="${ant.java.version}" arg2="1.1"/>
        <equals arg1="${ant.java.version}" arg2="1.2"/>
        <equals arg1="${ant.java.version}" arg2="1.3"/>
      </or>
    </condition>
    <fail message="Needs at least Java v1.4 or above." if="java.is.too.old"/>

    <property environment="environment"/>
    <condition property="czt.home" value="${environment.CZTHOME}">
      <isset property="environment.CZTHOME"/>
    </condition>
    <!-- If we have valid *.home properties set the *.jar.path properties from these -->
    <condition property="czt.base.jar.path" value="${czt.home}/corejava/lib/base.jar">
      <isset property="czt.home"/>
    </condition>
    <condition property="czt.core.jar.path" value="${czt.home}/corejava/lib/core.jar">
      <isset property="czt.home"/>
    </condition>
    <condition property="czt.jaxb.jar.path" value="${czt.home}/corejava/lib/jaxbSupport.jar">
      <isset property="czt.home"/>
    </condition>
    <condition property="gaffe.generator.jar.path" value="${czt.home}/corejava/lib/gaffe-generator.jar">
      <isset property="czt.home"/>
    </condition>

    <!-- Try getting them from the user -->
    <antcall target="-getcztbasejar"/>
    <antcall target="-getcztcorejar"/>
    <antcall target="-getcztjaxbjar"/>
    <!-- If all else fails just put the jar file under the local folder -->
    <property name="gaffe.generator.jar.path" value="lib/gaffe-generator.jar"/> 

    <!-- Check if we have the jar files we want -->
    <available property="czt.base.jar.available" classpath="${czt.base.jar.path}" 
               classname="net.sourceforge.czt.util.Visitor"/>
    <available property="czt.core.jar.available" classpath="${czt.core.jar.path}"
               classname="net.sourceforge.czt.z.impl.SpecImpl"/>
    <available property="czt.jaxb.jar.available" classpath="${czt.jaxb.jar.path}"
               classname="net.sourceforge.czt.z.jaxb.JaxbXmlReader"/>

    <!-- If we don't have the correct jar files, complain and bail out -->
    <!-- fail message="Could not find a correct jar file for CZT Java core base. (Trying ${czt.base.jar.path})" unless="czt.base.jar.available"/ -->
    <!-- fail message="Could not find a correct jar file for CZT Java core JAXB support. (Trying ${czt.jaxb.jar.path})" unless="czt.jaxb.jar.available"/ -->
    <!-- fail message="Could not find a correct jar file for CZT Java core. (Trying ${czt.core.jar.path}, ${czt.base.jar.path})" unless="czt.core.jar.available"/ -->

    <!-- Now that we have the needed properties, setup the class path we will use -->
    <path id="gaffe.generator.class.path">
      <pathelement path="${gaffe.generator.build.path}"/>
      <pathelement path="${czt.base.jar.path}"/>
      <pathelement path="${czt.core.jar.path}"/>
      <pathelement path="${czt.jaxb.jar.path}"/>
    </path>

    <!-- Set debug flags for javac to not compile debug info -->
    <property name="gaffe.javac.debug" value="no"/>
    <property name="gaffe.javac.debuglevel" value="none"/>
  </target>


  <target name="clean" description="Do a standard clean.">   
    <delete dir="${gaffe.generator.build.path}"/>
  </target>

  <target name="squeaky" depends="clean" description="Do a thorough clean.">   
    <delete file="${gaffe.generator.jar.path}"/>
    <!-- Do not delete ${gaffe.generator.jar.parent} because other packages may use it. -->
    <delete>
      <fileset dir="." includes="**/*~" defaultexcludes="no"/>
    </delete>
    <!-- delete includeEmptyDirs="yes" -->
      <!-- fileset dir="${gaffe.generator.resources.path}" includes="**/.xvpics" defaultexcludes="no"/ -->
    <!-- /delete -->
  </target>

  <target name="-set-debug">
    <property name="gaffe.javac.debug" value="yes"/>
    <property name="gaffe.javac.debuglevel" value="lines,vars,source"/>
  </target>

  <target name="classes" depends="-init" description="Build the classes.">   
    <mkdir dir="${gaffe.generator.build.path}"/>
    <depend srcdir="${gaffe.generator.source.path}" destdir="${gaffe.generator.build.path}"
            classpathref="gaffe.generator.class.path"/> 
    <javac srcdir="${gaffe.generator.source.path}" destdir="${gaffe.generator.build.path}" 
           classpathref="gaffe.generator.class.path"
	   debug="${gaffe.javac.debug}" debuglevel="${gaffe.javac.debuglevel}"/>
  </target>
  <target name="classes-debug" depends="-set-debug,classes"/>

  <target name="jar" depends="-init,classes" description="Build the jar file.">   
    <dirname file="${gaffe.generator.jar.path}" property="gaffe.generator.jar.parent"/>
    <mkdir dir="${gaffe.generator.jar.parent}"/>
    <jar destfile="${gaffe.generator.jar.path}" basedir="${gaffe.generator.build.path}" update="no">
      <manifest>
        <attribute name="Sealed" value="true"/>
	<attribute name="Main-Class" value="net.sourceforge.czt.animation.gui.generation.Generator"/>
      </manifest>
    </jar>
    <!-- jar destfile="${gaffe.generator.jar.path}" basedir="${gaffe.generator.resources.path}" update="yes"/ -->
    <jar destfile="${gaffe.generator.jar.path}" update="yes">
      <metainf dir="." includes="LICENSE"/>
    </jar>
    <jar destfile="${gaffe.generator.jar.path}" index="yes" update="yes"/>
  </target>
  <target name="jar-debug" depends="-set-debug,jar"/>

  <target name="all" depends="-init,classes,jar,doc" description="Build everything."/>
  <target name="all-debug" depends="-set-debug,all"/>
</project>




<project name="Parser" default="all">
  <property name="czt.home" location=".."/>
  <property file="${czt.home}/czt.properties"/>
  <property name="parser.jar.dir" location="${czt.home}/${jar.dir}"/>
  <property name="parser.jar.file" location="${parser.jar.dir}/${parser.jar.file}"/>
  <property name="parser.src.dir" location="src"/>
  <property name="parser.build.dir" location="build"/>
  <property name="parser.api.dir" location="doc/api"/>

  <taskdef resource="checkstyletask.properties"
    classpath="${checkstyle.jar}"/>

  <target name="init">
    <tstamp/>
    <mkdir dir="${parser.build.dir}"/>
  </target>

  <target name="all" depends="install, doc"
    description="build the jar files and the documentation"/>

  <target name="install" depends="compile"
          description="build and install the jar files">
    <mkdir dir="${parser.jar.dir}"/>
    <jar jarfile="${parser.jar.file}">
      <fileset dir="${parser.build.dir}"/>
    </jar>
  </target>

  <target name="scanner">
    <exec dir="." executable="make"/>
  </target>

  <target name="compile" depends="init, scanner"
          description="compile the sources">
    <javac srcdir="${parser.src.dir}"
           destdir="${parser.build.dir}">
      <include name="net/sourceforge/czt/scanner/**"/>    
    </javac>
  </target>

  <target name="doc" depends="api"
    description="build all the documentation"/>

  <target name="api"
          description="build the API documentation">
    <mkdir dir="${parser.api.dir}"/>
    <javadoc
      destdir="${parser.api.dir}"
      private="true">
      <packageset dir="${parser.src.dir}">
        <include name="net/sourceforge/czt/scanner/**"/>    
      </packageset>
      <tag name="czt.todo" description="To do:"/>
    </javadoc>
  </target>

  <target name="test" depends="install"
    description="build and run the tests">
    <ant dir="tests"/>
  </target>

  <target name="checkstyle" description="check java sources">
    <checkstyle config="${czt.home}/devtools/checkstyle.xml">
      <fileset dir="${parser.src.dir}"/>
      <formatter type="plain"/>
    </checkstyle>
  </target>

  <target name="clean"
          description="clean up">
    <exec dir="." executable="make">
      <arg line="clean"/>
    </exec>
    <delete dir="${parser.build.dir}"/>
    <delete dir="${parser.api.dir}"/>
    <ant dir="tests" target="clean"/>
  </target>
</project>
